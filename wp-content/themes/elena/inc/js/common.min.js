jQuery(document).ready(function ($) {

    var owlOffer,
        owlReviews,
        owlGallert, owlLeftSide, owlRightSide;


    owlOffer = $(".offers .item .image");

    owlGallert = $(".owlGallery");
    owlLeftSide = $(".owlLeftSide");
    owlRightSide = $(".owlRightSide");

    owlReviews = $("#owlReviews");


    /**
     * ==================================
     *          FUNCTIONS INIT
     * ==================================
     */

    slideLeftSideMenu("#toggleBtn");
    simpleTabs(".tabsWrap__item", ".tabsWrap", ".itemRowWrap", ".tabsContent", "active");
    owlChangeByClick(owlLeftSide, "a", "item-index", owlGallert);
    owlChangeByClick(owlRightSide, "a", "item-index", owlGallert);

    showPopup(".showPopup");
    hidePopup(".formWrap", ".popup", ".showPopup");


    /* Offer carousel */
    owlOffer.owlCarousel({
        items: 1,
        nav: false,
        dots: true,
        loop: true,
        autoplay: true,
        autoplayHoverPause: true,
    });


    /* Work examples slider */
    owlGallert.owlCarousel({
        items: 1,
        nav: true,
        dots: true,
        loop: true,
        autoplay: true,
        autoplayHoverPause: true,
        navText: ['<svg id="Слой_1" data-name="Слой 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 476.21 261.21"><polygon points="130.61 0 151.82 21.21 57.43 115.61 476.21 115.61 476.21 145.61 57.43 145.61 151.82 240 130.61 261.21 0 130.61 130.61 0"/></svg>', '<svg id="Слой_1" data-name="Слой 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 476.21 261.21"><polygon points="345.61 0 324.39 21.21 418.79 115.61 0 115.61 0 145.61 418.79 145.61 324.39 240 345.61 261.21 476.21 130.61 345.61 0"/></svg>'],
    });


    /* Reviews carousel */
    owlReviews.owlCarousel({
        items: 1,
        nav: true,
        dots: true,
        loop: true,
        autoplay: true,
        autoplayHoverPause: true,
        navText: ['<svg id="Слой_1" data-name="Слой 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 476.21 261.21"><polygon points="130.61 0 151.82 21.21 57.43 115.61 476.21 115.61 476.21 145.61 57.43 145.61 151.82 240 130.61 261.21 0 130.61 130.61 0"/></svg>', '<svg id="Слой_1" data-name="Слой 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 476.21 261.21"><polygon points="345.61 0 324.39 21.21 418.79 115.61 0 115.61 0 145.61 418.79 145.61 324.39 240 345.61 261.21 476.21 130.61 345.61 0"/></svg>'],
    });


    /**
     * ==================================
     *             FUNCTIONS
     * ==================================
     */

    /* Change owl-carousel by click on left image */
    function owlChangeByClick(elementsWrap, elementFind, dataIndex, owlObj) {
        elementsWrap.find(elementFind).on("click", function (e) {
            e.preventDefault();
            var number = $(this).data(dataIndex);
            owlObj.data('owl.carousel').to(number, 300, true);
        });
    }


    /* Simple tabs */
    function simpleTabs(tab, tabWrap, content, contentWrap, activeClassName) {

        var tabId;


        $(tab).on("click", function (event) {
            event.preventDefault();

            tabId = $(this).data("tab-id");

            //remove active class on tabs
            $(tabWrap).find(tab).removeClass(activeClassName);

            //set active class on tab
            $(this).addClass(activeClassName);

            //remove active class on content
            $(contentWrap).find(content).removeClass(activeClassName);

            //set active class on content
            $(content).eq(tabId).addClass(activeClassName);

        });

    }


    /* Toggle side menu */
    function slideLeftSideMenu(burger) {

        //resize
        $(window).on("resize", function () {
            if (window.innerWidth >= 1060) {
                $(burger).removeClass("on");
                $("body").removeClass("visibility-side-menu");
            }
        });

        $(burger).on("click", function (event) {
            event.preventDefault();

            $(this).toggleClass("on");
            $("body").toggleClass("visibility-side-menu");
        });

        //close menu after click out
        $(document).on("click", function (event) {
            var target = $(event.target);
            if (!target.closest(".sideBarWrap").length && !target.closest(burger).length) {
                $(burger).removeClass("on");
                $("body").removeClass("visibility-side-menu");
            }
        })

    }

    /* Show popup */
    function showPopup(btn) {
        $(btn).on("click", function (event) {
            event.preventDefault();

            var popupName = $(this).data("popup-name");
            var popup = $("#" + popupName);

            if (popup.length) {
                popup.addClass("active");
                $("body").addClass("popupShow");
            }
        })
    }

    /* Hide popup */
    function hidePopup(contentInPopup, popup, btn) {
        $(document).on("click", function (event) {
            var target = $(event.target);
            if (!target.closest(contentInPopup).length && !target.closest(btn).length) {
                $(popup).removeClass("active");
                $("body").removeClass("popupShow");
            }
        })
    }


    /* Hide popup after success */
    document.addEventListener('wpcf7mailsent', function (event) {
        setTimeout(function () {
            $(".popup").removeClass("active");
            $("body").removeClass("popupShow");
        }, 4000);
    }, false);


    /**
     * AJAX
     *
     * Testimonial
     */
    function ajaxTestimonialInsert(form, msgField) {
        var data = {
            action: 'ajax-testimonial-insert',
            nonce_code: metaVars.ajaxNonce
        };

        $(form).on("submit", function (event) {
            event.stopPropagation();
            event.preventDefault();
            data.user_data = $(this).serialize();

            $.post(metaVars.ajaxUrl, data, function (response) {
                if(response.success) {
                    $(msgField).removeClass("error").addClass("ok").html(response.data['msg']);
                    setTimeout(function () {
                        $(".popup").removeClass("active");
                        $("body").removeClass("popupShow");
                    }, 4000);
                } else {
                    $(msgField).removeClass("ok").addClass("error").html(response.data['msg']);
                }
            });
        });
    }

    ajaxTestimonialInsert("#testimonial","#ajaxMsgField");


    /* Scroll to id */
    $('a[href*="#"]')
        .not('[href="#"]')
        .not('[href="#0"]')
        .on("click", function (event) {
            if (
                location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '')
                &&
                location.hostname == this.hostname
            ) {
                $("#toggleBtn").removeClass("on");
                $("body").removeClass("visibility-side-menu");

                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {
                    event.preventDefault();
                    $('html, body').animate({
                        scrollTop: target.offset().top
                    }, 1000, function () {
                        var $target = $(target);
                        $target.focus();
                        if ($target.is(":focus")) {
                            return false;
                        } else {
                            $target.attr('tabindex', '-1');
                            $target.focus();
                        }
                        ;
                    });
                }
            }
        });

});